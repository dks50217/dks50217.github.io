import{av as L,aL as de,d as he,o as ve,s as pe,a as Q,z as ge,aM as U,aN as me,aO as N,v as Ce,x as ye,D as O,E as R,F as A,G as M,T as we,f as k,H as q,j,J as _e}from"./index.js";var D={},xe={get exports(){return D},set exports(s){D=s}},J,Y;function be(){if(Y)return J;Y=1;var s=1e3,c=s*60,e=c*60,i=e*24,p=i*7,v=i*365.25;J=function(t,n){n=n||{};var u=typeof t;if(u==="string"&&t.length>0)return b(t);if(u==="number"&&isFinite(t))return n.long?f(t):y(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function b(t){if(t=String(t),!(t.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(n){var u=parseFloat(n[1]),d=(n[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return u*v;case"weeks":case"week":case"w":return u*p;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*e;case"minutes":case"minute":case"mins":case"min":case"m":return u*c;case"seconds":case"second":case"secs":case"sec":case"s":return u*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function y(t){var n=Math.abs(t);return n>=i?Math.round(t/i)+"d":n>=e?Math.round(t/e)+"h":n>=c?Math.round(t/c)+"m":n>=s?Math.round(t/s)+"s":t+"ms"}function f(t){var n=Math.abs(t);return n>=i?l(t,n,i,"day"):n>=e?l(t,n,e,"hour"):n>=c?l(t,n,c,"minute"):n>=s?l(t,n,s,"second"):t+" ms"}function l(t,n,u,d){var m=n>=u*1.5;return Math.round(t/u)+" "+d+(m?"s":"")}return J}function Fe(s){e.debug=e,e.default=e,e.coerce=f,e.disable=v,e.enable=p,e.enabled=b,e.humanize=be(),e.destroy=l,Object.keys(s).forEach(t=>{e[t]=s[t]}),e.names=[],e.skips=[],e.formatters={};function c(t){let n=0;for(let u=0;u<t.length;u++)n=(n<<5)-n+t.charCodeAt(u),n|=0;return e.colors[Math.abs(n)%e.colors.length]}e.selectColor=c;function e(t){let n,u=null,d,m;function h(...o){if(!h.enabled)return;const g=h,r=Number(new Date),a=r-(n||r);g.diff=a,g.prev=n,g.curr=r,n=r,o[0]=e.coerce(o[0]),typeof o[0]!="string"&&o.unshift("%O");let C=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(_,x)=>{if(_==="%%")return"%";C++;const F=e.formatters[x];if(typeof F=="function"){const B=o[C];_=F.call(g,B),o.splice(C,1),C--}return _}),e.formatArgs.call(g,o),(g.log||e.log).apply(g,o)}return h.namespace=t,h.useColors=e.useColors(),h.color=e.selectColor(t),h.extend=i,h.destroy=e.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(d!==e.namespaces&&(d=e.namespaces,m=e.enabled(t)),m),set:o=>{u=o}}),typeof e.init=="function"&&e.init(h),h}function i(t,n){const u=e(this.namespace+(typeof n>"u"?":":n)+t);return u.log=this.log,u}function p(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n;const u=(typeof t=="string"?t:"").split(/[\s,]+/),d=u.length;for(n=0;n<d;n++)u[n]&&(t=u[n].replace(/\*/g,".*?"),t[0]==="-"?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function v(){const t=[...e.names.map(y),...e.skips.map(y).map(n=>"-"+n)].join(",");return e.enable(""),t}function b(t){if(t[t.length-1]==="*")return!0;let n,u;for(n=0,u=e.skips.length;n<u;n++)if(e.skips[n].test(t))return!1;for(n=0,u=e.names.length;n<u;n++)if(e.names[n].test(t))return!0;return!1}function y(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}function f(t){return t instanceof Error?t.stack||t.message:t}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Be=Fe;(function(s,c){c.formatArgs=i,c.save=p,c.load=v,c.useColors=e,c.storage=b(),c.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;f.splice(1,0,l,"color: inherit");let t=0,n=0;f[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(t++,u==="%c"&&(n=t))}),f.splice(n,0,l)}c.log=console.debug||console.log||(()=>{});function p(f){try{f?c.storage.setItem("debug",f):c.storage.removeItem("debug")}catch{}}function v(){let f;try{f=c.storage.getItem("debug")}catch{}return!f&&typeof process<"u"&&"env"in process&&(f={}.DEBUG),f}function b(){try{return localStorage}catch{}}s.exports=Be(c);const{formatters:y}=s.exports;y.j=function(f){try{return JSON.stringify(f)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(xe,D);const ke=D;var W={},Ae={get exports(){return W},set exports(s){W=s}};(function(s){var c=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function p(f,l,t){this.fn=f,this.context=l,this.once=t||!1}function v(f,l,t,n,u){if(typeof t!="function")throw new TypeError("The listener must be a function");var d=new p(t,n||f,u),m=e?e+l:l;return f._events[m]?f._events[m].fn?f._events[m]=[f._events[m],d]:f._events[m].push(d):(f._events[m]=d,f._eventsCount++),f}function b(f,l){--f._eventsCount===0?f._events=new i:delete f._events[l]}function y(){this._events=new i,this._eventsCount=0}y.prototype.eventNames=function(){var l=[],t,n;if(this._eventsCount===0)return l;for(n in t=this._events)c.call(t,n)&&l.push(e?n.slice(1):n);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(t)):l},y.prototype.listeners=function(l){var t=e?e+l:l,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var u=0,d=n.length,m=new Array(d);u<d;u++)m[u]=n[u].fn;return m},y.prototype.listenerCount=function(l){var t=e?e+l:l,n=this._events[t];return n?n.fn?1:n.length:0},y.prototype.emit=function(l,t,n,u,d,m){var h=e?e+l:l;if(!this._events[h])return!1;var o=this._events[h],g=arguments.length,r,a;if(o.fn){switch(o.once&&this.removeListener(l,o.fn,void 0,!0),g){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,t),!0;case 3:return o.fn.call(o.context,t,n),!0;case 4:return o.fn.call(o.context,t,n,u),!0;case 5:return o.fn.call(o.context,t,n,u,d),!0;case 6:return o.fn.call(o.context,t,n,u,d,m),!0}for(a=1,r=new Array(g-1);a<g;a++)r[a-1]=arguments[a];o.fn.apply(o.context,r)}else{var C=o.length,w;for(a=0;a<C;a++)switch(o[a].once&&this.removeListener(l,o[a].fn,void 0,!0),g){case 1:o[a].fn.call(o[a].context);break;case 2:o[a].fn.call(o[a].context,t);break;case 3:o[a].fn.call(o[a].context,t,n);break;case 4:o[a].fn.call(o[a].context,t,n,u);break;default:if(!r)for(w=1,r=new Array(g-1);w<g;w++)r[w-1]=arguments[w];o[a].fn.apply(o[a].context,r)}}return!0},y.prototype.on=function(l,t,n){return v(this,l,t,n,!1)},y.prototype.once=function(l,t,n){return v(this,l,t,n,!0)},y.prototype.removeListener=function(l,t,n,u){var d=e?e+l:l;if(!this._events[d])return this;if(!t)return b(this,d),this;var m=this._events[d];if(m.fn)m.fn===t&&(!u||m.once)&&(!n||m.context===n)&&b(this,d);else{for(var h=0,o=[],g=m.length;h<g;h++)(m[h].fn!==t||u&&!m[h].once||n&&m[h].context!==n)&&o.push(m[h]);o.length?this._events[d]=o.length===1?o[0]:o:b(this,d)}return this},y.prototype.removeAllListeners=function(l){var t;return l?(t=e?e+l:l,this._events[t]&&b(this,t)):(this._events=new i,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=e,y.EventEmitter=y,s.exports=y})(Ae);var E=null;typeof WebSocket<"u"?E=WebSocket:typeof MozWebSocket<"u"?E=MozWebSocket:typeof L<"u"?E=L.WebSocket||L.MozWebSocket:typeof window<"u"?E=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(E=self.WebSocket||self.MozWebSocket);var ee=E,K={},Pe={get exports(){return K},set exports(s){K=s}};function Le(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={},Ie={get exports(){return G},set exports(s){G=s}};const Oe={},Re=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),Se=de(Re);var te;function ie(){return te||(te=1,function(s,c){(function(e,i){s.exports=i()})(L,function(){var e=e||function(i,p){var v;if(typeof window<"u"&&window.crypto&&(v=window.crypto),typeof self<"u"&&self.crypto&&(v=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(v=globalThis.crypto),!v&&typeof window<"u"&&window.msCrypto&&(v=window.msCrypto),!v&&typeof L<"u"&&L.crypto&&(v=L.crypto),!v&&typeof Le=="function")try{v=Se}catch{}var b=function(){if(v){if(typeof v.getRandomValues=="function")try{return v.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof v.randomBytes=="function")try{return v.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function r(){}return function(a){var C;return r.prototype=a,C=new r,r.prototype=null,C}}(),f={},l=f.lib={},t=l.Base=function(){return{extend:function(r){var a=y(this);return r&&a.mixIn(r),(!a.hasOwnProperty("init")||this.init===a.init)&&(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var a in r)r.hasOwnProperty(a)&&(this[a]=r[a]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),n=l.WordArray=t.extend({init:function(r,a){r=this.words=r||[],a!=p?this.sigBytes=a:this.sigBytes=r.length*4},toString:function(r){return(r||d).stringify(this)},concat:function(r){var a=this.words,C=r.words,w=this.sigBytes,_=r.sigBytes;if(this.clamp(),w%4)for(var x=0;x<_;x++){var F=C[x>>>2]>>>24-x%4*8&255;a[w+x>>>2]|=F<<24-(w+x)%4*8}else for(var B=0;B<_;B+=4)a[w+B>>>2]=C[B>>>2];return this.sigBytes+=_,this},clamp:function(){var r=this.words,a=this.sigBytes;r[a>>>2]&=4294967295<<32-a%4*8,r.length=i.ceil(a/4)},clone:function(){var r=t.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var a=[],C=0;C<r;C+=4)a.push(b());return new n.init(a,r)}}),u=f.enc={},d=u.Hex={stringify:function(r){for(var a=r.words,C=r.sigBytes,w=[],_=0;_<C;_++){var x=a[_>>>2]>>>24-_%4*8&255;w.push((x>>>4).toString(16)),w.push((x&15).toString(16))}return w.join("")},parse:function(r){for(var a=r.length,C=[],w=0;w<a;w+=2)C[w>>>3]|=parseInt(r.substr(w,2),16)<<24-w%8*4;return new n.init(C,a/2)}},m=u.Latin1={stringify:function(r){for(var a=r.words,C=r.sigBytes,w=[],_=0;_<C;_++){var x=a[_>>>2]>>>24-_%4*8&255;w.push(String.fromCharCode(x))}return w.join("")},parse:function(r){for(var a=r.length,C=[],w=0;w<a;w++)C[w>>>2]|=(r.charCodeAt(w)&255)<<24-w%4*8;return new n.init(C,a)}},h=u.Utf8={stringify:function(r){try{return decodeURIComponent(escape(m.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return m.parse(unescape(encodeURIComponent(r)))}},o=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=h.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var a,C=this._data,w=C.words,_=C.sigBytes,x=this.blockSize,F=x*4,B=_/F;r?B=i.ceil(B):B=i.max((B|0)-this._minBufferSize,0);var S=B*x,I=i.min(S*4,_);if(S){for(var z=0;z<S;z+=x)this._doProcessBlock(w,z);a=w.splice(0,S),C.sigBytes-=I}return new n.init(a,I)},clone:function(){var r=t.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0});l.Hasher=o.extend({cfg:t.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){o.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var a=this._doFinalize();return a},blockSize:16,_createHelper:function(r){return function(a,C){return new r.init(C).finalize(a)}},_createHmacHelper:function(r){return function(a,C){return new g.HMAC.init(r,C).finalize(a)}}});var g=f.algo={};return f}(Math);return e})}(Ie)),G}(function(s,c){(function(e,i){s.exports=i(ie())})(L,function(e){return function(i){var p=e,v=p.lib,b=v.WordArray,y=v.Hasher,f=p.algo,l=[],t=[];(function(){function d(g){for(var r=i.sqrt(g),a=2;a<=r;a++)if(!(g%a))return!1;return!0}function m(g){return(g-(g|0))*4294967296|0}for(var h=2,o=0;o<64;)d(h)&&(o<8&&(l[o]=m(i.pow(h,1/2))),t[o]=m(i.pow(h,1/3)),o++),h++})();var n=[],u=f.SHA256=y.extend({_doReset:function(){this._hash=new b.init(l.slice(0))},_doProcessBlock:function(d,m){for(var h=this._hash.words,o=h[0],g=h[1],r=h[2],a=h[3],C=h[4],w=h[5],_=h[6],x=h[7],F=0;F<64;F++){if(F<16)n[F]=d[m+F]|0;else{var B=n[F-15],S=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,I=n[F-2],z=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;n[F]=S+n[F-7]+z+n[F-16]}var ae=C&w^~C&_,ce=o&g^o&r^g&r,le=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),ue=(C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25),X=x+ue+ae+t[F]+n[F],fe=le+ce;x=_,_=w,w=C,C=a+X|0,a=r,r=g,g=o,o=X+fe|0}h[0]=h[0]+o|0,h[1]=h[1]+g|0,h[2]=h[2]+r|0,h[3]=h[3]+a|0,h[4]=h[4]+C|0,h[5]=h[5]+w|0,h[6]=h[6]+_|0,h[7]=h[7]+x|0},_doFinalize:function(){var d=this._data,m=d.words,h=this._nDataBytes*8,o=d.sigBytes*8;return m[o>>>5]|=128<<24-o%32,m[(o+64>>>9<<4)+14]=i.floor(h/4294967296),m[(o+64>>>9<<4)+15]=h,d.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var d=y.clone.call(this);return d._hash=this._hash.clone(),d}});p.SHA256=y._createHelper(u),p.HmacSHA256=y._createHmacHelper(u)}(Math),e.SHA256})})(Pe);const ne=K;var Z={},Ee={get exports(){return Z},set exports(s){Z=s}};(function(s,c){(function(e,i){s.exports=i(ie())})(L,function(e){return function(){var i=e,p=i.lib,v=p.WordArray,b=i.enc;b.Base64={stringify:function(f){var l=f.words,t=f.sigBytes,n=this._map;f.clamp();for(var u=[],d=0;d<t;d+=3)for(var m=l[d>>>2]>>>24-d%4*8&255,h=l[d+1>>>2]>>>24-(d+1)%4*8&255,o=l[d+2>>>2]>>>24-(d+2)%4*8&255,g=m<<16|h<<8|o,r=0;r<4&&d+r*.75<t;r++)u.push(n.charAt(g>>>6*(3-r)&63));var a=n.charAt(64);if(a)for(;u.length%4;)u.push(a);return u.join("")},parse:function(f){var l=f.length,t=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var u=0;u<t.length;u++)n[t.charCodeAt(u)]=u}var d=t.charAt(64);if(d){var m=f.indexOf(d);m!==-1&&(l=m)}return y(f,l,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function y(f,l,t){for(var n=[],u=0,d=0;d<l;d++)if(d%4){var m=t[f.charCodeAt(d-1)]<<d%4*2,h=t[f.charCodeAt(d)]>>>6-d%4*2,o=m|h;n[u>>>2]|=o<<24-u%4*8,u++}return v.create(n,u)}}(),e.enc.Base64})})(Ee);const re=Z;function V(){return V=Object.assign?Object.assign.bind():function(s){for(var c=1;c<arguments.length;c++){var e=arguments[c];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},V.apply(this,arguments)}function Te(s,c){if(s==null)return{};var e={},i=Object.keys(s),p,v;for(v=0;v<i.length;v++)p=i[v],!(c.indexOf(p)>=0)&&(e[p]=s[p]);return e}var P;(function(s){s[s.Hello=0]="Hello",s[s.Identify=1]="Identify",s[s.Identified=2]="Identified",s[s.Reidentify=3]="Reidentify",s[s.Event=5]="Event",s[s.Request=6]="Request",s[s.RequestResponse=7]="RequestResponse",s[s.RequestBatch=8]="RequestBatch",s[s.RequestBatchResponse=9]="RequestBatchResponse"})(P||(P={}));var se;(function(s){s[s.None=0]="None",s[s.General=1]="General",s[s.Config=2]="Config",s[s.Scenes=4]="Scenes",s[s.Inputs=8]="Inputs",s[s.Transitions=16]="Transitions",s[s.Filters=32]="Filters",s[s.Outputs=64]="Outputs",s[s.SceneItems=128]="SceneItems",s[s.MediaInputs=256]="MediaInputs",s[s.Vendors=512]="Vendors",s[s.Ui=1024]="Ui",s[s.All=1023]="All",s[s.InputVolumeMeters=65536]="InputVolumeMeters",s[s.InputActiveStateChanged=131072]="InputActiveStateChanged",s[s.InputShowStateChanged=262144]="InputShowStateChanged",s[s.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(se||(se={}));var oe;(function(s){s[s.None=-1]="None",s[s.SerialRealtime=0]="SerialRealtime",s[s.SerialFrame=1]="SerialFrame",s[s.Parallel=2]="Parallel"})(oe||(oe={}));function ze(s,c,e){const i=re.stringify(ne(e+s));return re.stringify(ne(i+c))}const Me=["authentication","rpcVersion"],H=ke("obs-websocket-js");class $ extends Error{constructor(c,e){super(e),this.code=void 0,this.code=c}}class T extends W{constructor(...c){super(...c),this._identified=!1,this.internalListeners=new W,this.socket=void 0}static generateMessageId(){return String(T.requestCounter++)}get identified(){return this._identified}async connect(c="ws://127.0.0.1:4455",e,i={}){var p=this;this.socket&&await this.disconnect();try{const v=this.internalEventPromise("ConnectionClosed"),b=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const y=await p.createConnection(c);return p.emit("Hello",y),p.identify(y,e,i)}(),new Promise((y,f)=>{b.then(l=>{l.message&&f(l)}),v.then(l=>{f(l)})})])}catch(v){throw await this.disconnect(),v}}async disconnect(){if(!this.socket||this.socket.readyState===ee.CLOSED)return;const c=this.internalEventPromise("ConnectionClosed");this.socket.close(),await c}async reidentify(c){const e=this.internalEventPromise(`op:${P.Identified}`);return await this.message(P.Reidentify,c),e}async call(c,e){const i=T.generateMessageId(),p=this.internalEventPromise(`res:${i}`);await this.message(P.Request,{requestId:i,requestType:c,requestData:e});const{requestStatus:v,responseData:b}=await p;if(!v.result)throw new $(v.code,v.comment);return b}async callBatch(c,e={}){const i=T.generateMessageId(),p=this.internalEventPromise(`res:${i}`);await this.message(P.RequestBatch,V({requestId:i,requests:c},e));const{results:v}=await p;return v}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(c){var e;const i=this.internalEventPromise("ConnectionOpened"),p=this.internalEventPromise(`op:${P.Hello}`);this.socket=new ee(c,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await i;const v=(e=this.socket)==null?void 0:e.protocol;if(!v)throw new $(-1,"Server sent no subprotocol");if(v!==this.protocol)throw new $(-1,"Server sent an invalid subprotocol");return p}async identify(c,e,i={}){let{authentication:p,rpcVersion:v}=c,b=Te(c,Me);const y=V({rpcVersion:v},i);p&&e&&(y.authentication=ze(p.salt,p.challenge,e));const f=this.internalEventPromise(`op:${P.Identified}`);await this.message(P.Identify,y);const l=await f;return this._identified=!0,this.emit("Identified",l),V({rpcVersion:v},b,l)}async message(c,e){if(!this.socket)throw new Error("Not connected");if(!this.identified&&c!==1)throw new Error("Socket not identified");const i=await this.encodeMessage({op:c,d:e});this.socket.send(i)}async internalEventPromise(c){return new Promise(e=>{this.internalListeners.once(c,e)})}onOpen(c){H("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",c)}async onMessage(c){try{const{op:e,d:i}=await this.decodeMessage(c.data);if(H("socket.message: %d %j",e,i),e===void 0||i===void 0)return;switch(e){case P.Event:{const{eventType:p,eventData:v}=i;this.emit(p,v);return}case P.RequestResponse:case P.RequestBatchResponse:{const{requestId:p}=i;this.internalListeners.emit(`res:${p}`,i);return}default:this.internalListeners.emit(`op:${e}`,i)}}catch(e){H("error handling message: %o",e)}}onError(c){H("socket.error: %o",c);const e=new $(-1,c.message);this.emit("ConnectionError",e),this.internalListeners.emit("ConnectionError",e)}onClose(c){H("socket.close: %s (%d)",c.reason,c.code);const e=new $(c.code,c.reason);this.emit("ConnectionClosed",e),this.internalListeners.emit("ConnectionClosed",e),this.cleanup()}}T.requestCounter=1;typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class qe extends T{constructor(...c){super(...c),this.protocol="obswebsocket.json"}async encodeMessage(c){return JSON.stringify(c)}async decodeMessage(c){return JSON.parse(c)}}const He={"p-b-2":""},Ve=he({__name:"obs",setup(s){var h;const c=(h=JSON.parse(window.localStorage.getItem("obs-data")??"{}"))==null?void 0:h.password,e=ve("obs2-data",{port:"4455",password:c??"",greaterThanOrEqualTo:4,partyLength:1}),i=pe({connecting:!1,recording:!1,inACTCombat:!1}),p=new qe,v=Q(!0),b=Q(!1);ge(async()=>{p.on("ExitStarted",t),p.on("ConnectionClosed",t),p.on("ConnectionError",t),p.on("RecordStateChanged",n),addOverlayListener("onLogEvent",u),addOverlayListener("onInCombatChangedEvent",d),addOverlayListener("PartyChanged",m),startOverlayEvents(),e.value.password!==""?(await y(),p.call("GetRecordStatus").then(o=>i.recording=o.outputActive)):U.modal.alert({content:"先鎖定懸浮窗，再填寫埠與密碼",title:"初次使用",width:"80%",size:"mini"})}),me(()=>{p.off("ExitStarted",t),p.off("ConnectionClosed",t),p.off("ConnectionError",t),p.off("RecordStateChanged",n),removeOverlayListener("onLogEvent",u),removeOverlayListener("onInCombatChangedEvent",d),removeOverlayListener("PartyChanged",m),p.disconnect()});async function y(){return p.connect(`ws://127.0.0.1:${e.value.port}`,e.value.password).then(o=>{U.modal.message({content:"連線成功",status:"success",width:"7rem",size:"mini",top:8}),i.connecting=!0,v.value=!1,b.value=!1}).catch(o=>{U.modal.message({content:"連線失敗",status:"error",width:"7rem",size:"mini",top:8}),i.connecting=!1})}async function f(o=!0,g=!1){if(!g&&e.value.partyLength<e.value.greaterThanOrEqualTo)return Promise.resolve();i.connecting||await y(),i.recording&&o?p.call("StopRecord").then(()=>setTimeout(()=>p.call("StartRecord").catch(()=>{}),1500)).catch(()=>{}):p.call("StartRecord").catch(()=>{})}async function l(){return i.recording?p.call("StopRecord").catch(()=>{}):Promise.resolve()}function t(){i.connecting=!1}function n(o){switch(o.outputState){case"OBS_WEBSOCKET_OUTPUT_STARTED":i.recording=!0;return;case"OBS_WEBSOCKET_OUTPUT_STOPPED":i.recording=!1;return}}async function u(o){for(const g of o.detail.logs)/^.{14} \w+ 00:(?:00B9|0[12]39)::?(?:距離戰鬥開始還有|Battle commencing in |戦闘開始まで)\d+[^（(]+[（(]/i.test(g)?f():/^.{14} (?:Director 21:.{8}:4000000F|Territory 01:|ChatLog 00:0038::end$|ChatLog 00:(?:00B9|0[12]39)::(?:.+取消了戰鬥開始倒計時。|Countdown canceled by .+\.|.+により、戦闘開始カウントがキャンセルされました。))/i.test(g)&&l()}async function d(o){!i.inACTCombat&&o.detail.inACTCombat&&f(!1),i.inACTCombat&&!o.detail.inACTCombat&&l(),i.inACTCombat=o.detail.inACTCombat}function m(o){var g;e.value.partyLength=((g=o.party)==null?void 0:g.length)??0}return(o,g)=>{const r=N("vxe-button"),a=N("vxe-input"),C=N("vxe-form-item"),w=N("vxe-form");return Ce(),ye(_e,null,[O(M("header",null,[O(M("div",null,[M("i",{class:"vxe-icon-dot icon",style:we({color:A(i).recording?"red":"gray",textShadow:"0px  0px 3px black"})},null,4),O(k(r,{class:"btns",icon:"vxe-icon-caret-right",onClick:g[0]||(g[0]=_=>f(!1,!0))},null,512),[[R,!A(i).recording]]),O(k(r,{class:"btns",icon:"vxe-icon-close",onClick:l,size:"mini"},null,512),[[R,A(i).recording]]),O(k(r,{class:"btns",icon:"vxe-icon-cut",onClick:g[1]||(g[1]=_=>f(!0,!0)),size:"mini"},null,512),[[R,A(i).recording]]),k(r,{class:"btns settings",icon:"vxe-icon-setting",onClick:g[2]||(g[2]=_=>v.value=!A(v)),size:"mini"})],512),[[R,A(i).connecting]]),O(M("div",null,[k(r,{class:"btns",style:{width:"auto !important"},size:"medium",icon:"vxe-icon-eye-fill-close",onClick:g[3]||(g[3]=_=>b.value=!0)},{default:q(()=>[j("隱藏頁面")]),_:1})],512),[[R,!A(i).connecting]])],512),[[R,!A(b)]]),O(M("main",He,[k(w,{data:A(e)},{default:q(()=>[k(C,{span:"24"},{default:q(({data:_})=>[j(" 自動錄製最少小隊人數 "),k(a,{modelValue:_.greaterThanOrEqualTo,"onUpdate:modelValue":x=>_.greaterThanOrEqualTo=x,size:"small",type:"integer",min:"0",max:"8",style:{width:"3rem","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),k(C,{span:"24"},{default:q(({data:_})=>[j(" 埠 "),k(a,{modelValue:_.port,"onUpdate:modelValue":x=>_.port=x,size:"small",placeholder:"埠號",style:{width:"4rem","margin-right":"5px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),k(C,{span:"24"},{default:q(({data:_})=>[j(" 密碼 "),k(a,{modelValue:_.password,"onUpdate:modelValue":x=>_.password=x,size:"small",placeholder:"密碼",type:"password",style:{width:"12rem"}},null,8,["modelValue","onUpdate:modelValue"]),k(r,{content:"無法輸入",size:"mini",icon:"vxe-icon-question",type:"text",status:"info",onClick:g[4]||(g[4]=x=>A(U).modal.message({content:"先點選ACT，再點選懸浮窗，即可正常輸入"}))})]),_:1})]),_:1},8,["data"]),k(r,{size:"mini",status:"primary",icon:"vxe-icon-swap",content:"連線",onClick:y}),k(r,{type:"text",status:"info",size:"mini",icon:"vxe-icon-warning-circle",content:"未連線到OBS",disabled:!0})],512),[[R,!A(b)&&(!A(i).connecting||A(v))]])],64)}}});export{Ve as default};
