import{d as L,o as M,a as H,aO as f,v as _,Q as w,H as a,f as r,F as c,j as k,x as G,K,J as R,G as E,R as F,Z as J,L as Q,O as Y,P as Z}from"./index.js";import{E as q}from"./el-switch.js";import{E as W,a as X}from"./el-form-item.js";import{E as A}from"./el-row.js";import{g as ii,E as ei}from"./actionChinese.js";import{E as si}from"./el-input.js";import{h as ti}from"./moment.js";import{E as I}from"./index2.js";import{E as ri}from"./index3.js";import"./vnode.js";import"./scroll.js";var C=(p=>(p[p.特殊=32]="特殊",p[p.DOT=64]="DOT",p[p.物理=128]="物理",p[p.魔法=1024]="魔法",p))(C||{});const x=[{name:"鐵壁",description:"減輕所受到的傷害",id:1191,icon:13911,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"盾陣",description:"受到攻擊時必定發動格擋",id:1856,icon:12510,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"干預",description:"減輕所受到的傷害",id:1174,icon:12511,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"預警",description:"減輕所受到的傷害",id:74,icon:10151,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"武裝",description:"減輕所受到的傷害",id:1176,icon:12513,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神聖領域",description:"除特定攻擊之外其他所有攻擊均無效化",id:82,icon:12504,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"聖光幕簾",description:"抵消一定傷害",id:727,icon:12509,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"聖盾陣",description:"受到攻擊時必定發動格擋",id:2674,icon:12515,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"騎士的堅守",description:"減輕所受到的傷害",id:2675,icon:12516,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的直覺",description:"自身發動戰技命中時可以恢復體力，同時減輕所受到的傷害",id:735,icon:12555,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"戰慄",description:`體力最大值提高
習得戰慄效果提高后追加效果：自身所受的治療效果提高`,id:87,icon:10254,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"復仇",description:"受到物理攻擊時會發動反擊",id:89,icon:10256,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擺脫",description:"抵消一定傷害",id:1457,icon:12557,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"死鬥",description:"除特定攻擊之外其他所有對自身發動的攻擊均無法令體力減少到1以下",id:409,icon:10266,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血氣",description:"自身發動戰技命中時可以恢復體力，同時減輕所受到的傷害",id:2678,icon:12562,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血潮",description:"減輕所受到的傷害",id:2679,icon:12563,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初的血煙",description:"抵消一定傷害",id:2680,icon:12564,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"至黑之夜",description:"抵消一定傷害",id:1178,icon:13118,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"棄明投暗",description:"減輕所受到的魔法傷害",id:746,icon:13114,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"暗影墻",description:"減輕所受到的傷害",id:747,icon:13113,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑佈道",description:"減輕所受到的魔法傷害",id:1894,icon:13122,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"行屍走肉",description:`受到致命傷害時體力減為1，並附加死而不僵狀態
但是對部分攻擊無效`,id:810,icon:13115,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"獻奉",description:"減輕所受到的傷害",id:2682,icon:13123,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"石之心",description:"減輕所受到的傷害",id:1840,icon:13610,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"殘暴彈",description:"抵消一定傷害",id:1898,icon:13614,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"偽裝",description:"招架發動率提高，減輕所受到的傷害",id:1832,icon:13602,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"星雲",description:"減輕所受到的傷害",id:1834,icon:13604,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"光之心",description:"減輕所受到的魔法傷害",id:1839,icon:13609,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"超火流星",description:"除特定攻擊之外其他所有攻擊均無效化",id:1836,icon:13606,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"剛玉之心",description:"減輕所受到的傷害",id:2683,icon:13615,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"剛玉之清",description:"減輕所受到的傷害",id:2684,icon:13616,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"神祝禱",description:"抵消一定傷害",id:1218,icon:12632,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"節制",description:"減輕所受到的傷害",id:1873,icon:12633,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"水流幕",description:"減輕所受到的傷害",id:2708,icon:12638,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"鼓舞",description:"抵消一定傷害",id:297,icon:12801,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"激勵",description:"抵消一定傷害",id:1918,icon:12814,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"熾天的幕簾",description:"抵消一定傷害",id:1917,icon:12848,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"野戰治療陣",description:"減輕所受到的傷害",id:299,icon:12803,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"異想的幻光",description:"發動治療魔法的治療量提高，且受到魔法攻擊的傷害減少",id:317,icon:12828,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"熾天的幻光",description:"發動治療魔法的治療量提高，且受到魔法攻擊的傷害減少",id:1875,icon:12847,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"生命回生法",description:"體力最大值提高，同時自身所受體力恢復效果提高",id:2710,icon:12815,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"怒濤之計",description:"減輕所受到的傷害",id:2711,icon:12816,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"命運之輪",description:"減輕所受到的傷害",id:849,icon:13226,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"天星交錯",description:"抵消一定傷害",id:1889,icon:13250,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"擢升",description:"減輕所受到的傷害",id:2717,icon:13262,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"中間學派",description:"抵消一定傷害",id:1921,icon:13255,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡診斷",description:"抵消一定傷害",id:2607,icon:12954,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"齊衡診斷",description:"抵消一定傷害",id:2608,icon:12955,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"均衡預後",description:"抵消一定傷害",id:2609,icon:12954,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"堅角清汁",description:"減輕所受到的傷害",id:2618,icon:12964,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"白牛清汁",description:"減輕所受到的傷害",id:2619,icon:12965,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整體論",description:"減輕所受到的傷害",id:3003,icon:12971,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"整體盾",description:"抵消一定傷害",id:3365,icon:12972,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"血印",description:"輸血狀態消失後消耗血印檔數重新附加輸血狀態，持續時間結束后根據血印剩餘檔數恢復自身體力",id:2642,icon:17585,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"泛血印",description:"泛輸血狀態消失後消耗血印檔數重新附加泛輸血狀態，持續時間結束后根據泛血印剩餘檔數恢復自身體力",id:2643,icon:17355,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"心眼",description:"下次受到攻擊時所受到的傷害減輕",id:1232,icon:13307,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"金剛極意",description:"減輕所受到的一部分傷害",id:1179,icon:12527,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"行吟",description:"減輕所受到的傷害",id:1934,icon:12615,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"策動",description:"減輕所受到的傷害",id:1951,icon:13021,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"防守之桑巴",description:"減輕所受到的傷害",id:1826,icon:13715,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"即興表演結束",description:"抵消一定傷害",id:2697,icon:13721,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"殘影",description:"抵消一定傷害",id:488,icon:10605,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"魔罩",description:"抵消一定傷害",id:168,icon:10456,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守護之光",description:"抵消一定傷害",id:2702,icon:12691,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"守護紋",description:"抵消一定傷害",id:2597,icon:12934,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"抗死",description:"減輕所受到的魔法傷害，同時自身所受體力恢復效果提高",id:2707,icon:13408,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!0},{name:"雪仇",description:"攻擊所造成的傷害降低",id:1193,icon:13901,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"牽制",description:"物理攻擊和魔法攻擊所造成的傷害降低",id:1195,icon:13904,type:"multiplier",multiplier:{physics:1,magic:.5,darkness:0},isFriendly:!1},{name:"昏亂",description:"物理攻擊和魔法攻擊所造成的傷害降低",id:1203,icon:13917,type:"multiplier",multiplier:{physics:.5,magic:1,darkness:0},isFriendly:!1},{name:"體力增加",description:"體力最大值提高",id:2120,icon:13523,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"腐臭",description:"造成的傷害降低",id:1715,icon:13502,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!1},{name:"智力精神降低",description:"智力與精神有所降低",id:2115,icon:13518,type:"multiplier",multiplier:{physics:0,magic:1,darkness:0},isFriendly:!1},{name:"龍之力",description:"受到的傷害降低",id:2500,icon:13539,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"超硬化",description:"無法自由活動，但受到攻擊的傷害減少",id:1722,icon:13509,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"玄結界",description:"減輕所受到的傷害，受到一定傷害后將附加玄天武水壁狀態",id:2496,icon:13535,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"仙人盾",description:"受到的傷害降低",id:2119,icon:13522,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"強力守護",description:"令自身所受到的傷害減少，同時會以攻擊力降低為代價提高自身仇恨",id:1719,icon:13506,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"哥佈防御",description:"抵消一定傷害",id:2114,icon:13517,type:"absorbed",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"銅墻鐵盾",description:"減輕所受到的傷害",id:194,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"堅守要塞",description:"減輕所受到的傷害",id:195,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"終極堡壘",description:"減輕所受到的傷害",id:196,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"原初大地",description:"減輕所受到的傷害",id:863,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"暗黑之力",description:"減輕所受到的傷害",id:864,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0},{name:"靈魂之青",description:"減輕所受到的傷害",id:1931,icon:16306,type:"multiplier",multiplier:{physics:1,magic:1,darkness:1},isFriendly:!0}];new Map(x.map(p=>[p.id,p]));function ni(p){if(typeof p=="number"){let i=[..."000000"],o=p.toString();if(o.length>3){const u=[...o].slice(0,o.length-3).concat(..."000");i=[...i.slice(0,6-u.length),...u]}let g=[..."000000"];return g=[...g.slice(0,6-o.length),...o],`${i.join("")}/${g.join("")}.png`}else return p}const fi=L({__name:"fflogsCsvTimelineCreate",setup(p){const i=M("fflogs-csv-timeline-create",{api_key:"",url:"",fight:void 0,enemies:[],friendlies:[],enemiesIDs:[],friendyIDs:[],takenEvents:[],code:"",showCN:!0,filter:{friendlyID:0},tableData:[],keigenns:[]});i.value.keigenns=x.map(e=>Object.assign(e,{icon:typeof e.icon=="number"?ni(e.icon):e.icon}));const o=H(!1);async function g(){o.value=!0;let e=i.value.url.match(new RegExp("(?<=^|\\/)(?<code>[\\d\\w]{16,})\\/?#fight=(?<fight>\\d+|last)"));if(i.value.api_key.length!==32){I.alert("錯誤的 API key");return}if(!e){ri.error("戰鬥記錄輸入有誤");return}i.value.code=e.groups.code,await fetch(`https://cn.fflogs.com/v1/report/fights/${i.value.code}?api_key=${i.value.api_key}`).then(s=>s.json()).then(async s=>{var d;const m=(e.groups.fight==="last"?s.fights.length:parseInt(e.groups.fight))-1;i.value.fight=s.fights[m],i.value.enemiesIDs=s.enemies.filter(t=>t.type==="Boss").map(t=>t.id),i.value.enemies=s.enemies,i.value.friendlies=s.friendlies.filter(t=>t.fights.find(n=>n.id===m)),i.value.friendyIDs=i.value.friendlies.map(t=>t.id).filter(t=>{var n;return((n=s.friendlies.find(b=>b.id===t))==null?void 0:n.type)!=="LimitBreak"}),i.value.takenEvents=[],await u("taken",i.value.fight.start_time,i.value.fight.end_time,0),i.value.takenEvents=i.value.takenEvents.filter(t=>t.ability.name!=="Combined DoTs"&&t.type==="damage").sort((t,n)=>t.timestamp-n.timestamp),i.value.filter.friendlyID=((d=i.value.friendyIDs)==null?void 0:d[0])??0,v()}).catch(s=>{I.alert(s)}),o.value=!1}async function u(e,s,m,d){d>=0&&await fetch(e==="casts"?`https://cn.fflogs.com/v1/report/events/casts/${i.value.code}?start=${s}&end=${m}&hostility=1&sourceid=${i.value.enemiesIDs[d]}&api_key=${i.value.api_key}`:`https://cn.fflogs.com/v1/report/events/damage-taken/${i.value.code}?start=${s}&end=${m}&hostility=0&sourceid=${i.value.friendyIDs[d]}&api_key=${i.value.api_key}`).then(t=>t.json()).then(async t=>{let n;if(e==="casts")n=t;else if(e==="taken")n=t;else throw new Error("Invalid event type: "+e);if(!n.events)throw new Error("result has no events");e==="taken"&&i.value.takenEvents.push(...n.events),n!=null&&n.nextPageTimestamp&&(n==null?void 0:n.nextPageTimestamp)>0&&n.nextPageTimestamp<m&&await u(e,n.nextPageTimestamp,m,d),e==="casts"&&d<i.value.enemiesIDs.length-1&&await u(e,s,m,d+1),e==="taken"&&d<i.value.friendyIDs.length-1&&await u(e,s,m,d+1)})}const D=e=>{var s;return ti.utc(Number(e)-(((s=i.value.fight)==null?void 0:s.start_time)??0)).format("mm:ss.S")},V=e=>ii(e),$=e=>C[e]??"未知";function v(){i.value.tableData=i.value.takenEvents.filter(e=>e.targetID==i.value.filter.friendlyID)}const N=({row:e})=>"row-type-"+e.type;return(e,s)=>{const m=si,d=W,t=ei,n=Q,b=A,S=f("vxe-radio-button"),B=f("vxe-radio-group"),P=X,y=f("vxe-column"),T=q,j=f("vxe-table"),O=Y,z=Z;return _(),w(z,null,{default:a(()=>[r(O,{"p-t-0":""},{default:a(()=>[r(P,null,{default:a(()=>[r(d,null,{default:a(()=>[r(b,{gutter:5,style:{width:"100%"}},{default:a(()=>[r(t,{span:6},{default:a(()=>[r(d,{label:"API KEY"},{default:a(()=>[r(m,{modelValue:c(i).api_key,"onUpdate:modelValue":s[0]||(s[0]=l=>c(i).api_key=l),type:"password",placeholder:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),r(t,{span:12},{default:a(()=>[r(d,{label:"FIGHT CODE"},{default:a(()=>[r(m,{modelValue:c(i).url,"onUpdate:modelValue":s[1]||(s[1]=l=>c(i).url=l),type:"text",placeholder:""},null,8,["modelValue"])]),_:1})]),_:1}),r(t,{span:6},{default:a(()=>[r(n,{type:"primary",onClick:g,loading:c(o)},{default:a(()=>[k("開始分析")]),_:1},8,["loading"])]),_:1})]),_:1}),r(t,{"p-t-3":""},{default:a(()=>[k("視角： "),r(B,{modelValue:c(i).filter.friendlyID,"onUpdate:modelValue":s[2]||(s[2]=l=>c(i).filter.friendlyID=l),onChange:v},{default:a(()=>[(_(!0),G(R,null,K(c(i).friendyIDs,l=>{var h;return _(),w(S,{label:l,content:(h=c(i).friendlies.find(U=>U.id===l))==null?void 0:h.icon},null,8,["label","content"])}),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(j,{size:"small",border:"",loading:c(o),class:"mytable-scrollbar",height:"720",align:"center","show-header-overflow":"tooltip","show-overflow":!0,"scroll-x":{enabled:!0,oSize:15},"scroll-y":{enabled:!0,oSize:15,mode:"wheel"},data:c(i).tableData,"row-config":{isHover:!1,height:25},"row-class-name":N},{default:a(()=>[r(y,{title:"時間",width:"65",fixed:"left"},{default:a(({row:l})=>[E("span",null,F(D(l.timestamp)),1)]),_:1}),r(y,{fixed:"left",width:"140"},{header:a(()=>[r(T,{modelValue:c(i).showCN,"onUpdate:modelValue":s[3]||(s[3]=l=>c(i).showCN=l),"inactive-text":"原","active-text":"漢",size:"small"},null,8,["modelValue"])]),default:a(({row:l})=>[E("span",{class:J("ability-type-"+l.ability.type)},F(c(i).showCN&&V(Number(l.ability.guid))||l.ability.name),3)]),_:1}),r(y,{title:"型別",width:"60"},{default:a(({row:l})=>[k(F($(l.ability.type)),1)]),_:1}),r(y,{title:"傷害值",width:"80"},{default:a(({row:l})=>{var h;return[k(F(((h=l.unmitigatedAmount)==null?void 0:h.toLocaleString())??"-"),1)]}),_:1}),r(y,{field:"multiplier",title:"減傷",width:"50"}),r(y,{field:"absorbed",title:"護盾",width:"60"}),r(y,{field:"amount",title:"實際",width:"60"})]),_:1},8,["loading","data"])]),_:1})]),_:1})}}});export{fi as default};
