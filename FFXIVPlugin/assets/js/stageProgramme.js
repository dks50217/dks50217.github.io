import{d as j,s as q,a as p,c as k,w as G,v as h,x as v,G as l,R as C,F as n,T as m,J as N,K as Y,D as i,E as O,j as c,ax as y,aq as K,ay as Q,y as W,Z as X,at as ee,au as te}from"./index.js";import{h as d}from"./moment.js";import{_ as ae}from"./_plugin-vue_export-helper.js";const se=g=>(ee("data-v-ec9fe08c"),g=g(),te(),g),oe=W('<svg xmlns="http://www.w3.org/2000/svg" class="icon clock" width="60" height="70" viewBox="0 0 60 70" fill="none" data-v-ec9fe08c><path d="M53.5685 11.7169L58.2818 16.4303L53.4385 21.2738C58.2244 27.2645 60.5349 34.8603 59.8954 42.5013C59.256 50.1423 55.7152 57.2485 50.0001 62.3603C44.2851 67.4722 36.8297 70.2018 29.1652 69.9884C21.5006 69.775 14.2086 66.6349 8.7868 61.213C3.36502 55.7911 0.224998 48.499 0.0116294 40.8342C-0.201739 33.1695 2.52774 25.7139 7.63949 19.9988C12.7512 14.2836 19.8572 10.7427 27.4981 10.1033C35.1389 9.46381 42.7346 11.7743 48.7252 16.5603L53.5685 11.7169ZM38.9319 61.5579C44.2831 59.341 48.6184 55.2129 51.0947 49.9765C53.5711 44.7402 54.0113 38.77 52.3298 33.2271C50.6483 27.6841 46.9654 22.9648 41.9972 19.9868C37.0291 17.0089 31.1309 15.9854 25.4499 17.1152C19.7689 18.2451 14.7113 21.4476 11.2606 26.0999C7.80989 30.7522 6.2129 36.5217 6.7802 42.2862C7.34751 48.0507 10.0386 53.3982 14.33 57.2885C18.6213 61.1788 24.2063 63.3339 29.9985 63.3346C33.063 63.3346 36.0974 62.7308 38.9285 61.5579H38.9319ZM33.3319 23.3338V43.3342H26.6652V23.3338H33.3319ZM43.3318 0V6.6668H16.6652V0H43.3318Z" fill="url(#paint0_linear_2392_974)" data-v-ec9fe08c></path><path d="M53.5685 11.7169L58.2818 16.4303L53.4385 21.2738C58.2244 27.2645 60.5349 34.8603 59.8954 42.5013C59.256 50.1423 55.7152 57.2485 50.0001 62.3603C44.2851 67.4722 36.8297 70.2018 29.1652 69.9884C21.5006 69.775 14.2086 66.6349 8.7868 61.213C3.36502 55.7911 0.224998 48.499 0.0116294 40.8342C-0.201739 33.1695 2.52774 25.7139 7.63949 19.9988C12.7512 14.2836 19.8572 10.7427 27.4981 10.1033C35.1389 9.46381 42.7346 11.7743 48.7252 16.5603L53.5685 11.7169ZM38.9319 61.5579C44.2831 59.341 48.6184 55.2129 51.0947 49.9765C53.5711 44.7402 54.0113 38.77 52.3298 33.2271C50.6483 27.6841 46.9654 22.9648 41.9972 19.9868C37.0291 17.0089 31.1309 15.9854 25.4499 17.1152C19.7689 18.2451 14.7113 21.4476 11.2606 26.0999C7.80989 30.7522 6.2129 36.5217 6.7802 42.2862C7.34751 48.0507 10.0386 53.3982 14.33 57.2885C18.6213 61.1788 24.2063 63.3339 29.9985 63.3346C33.063 63.3346 36.0974 62.7308 38.9285 61.5579H38.9319ZM33.3319 23.3338V43.3342H26.6652V23.3338H33.3319ZM43.3318 0V6.6668H16.6652V0H43.3318Z" fill="white" data-v-ec9fe08c></path><defs data-v-ec9fe08c><linearGradient id="paint0_linear_2392_974" x1="0" y1="0" x2="62.1639" y2="69.6625" gradientUnits="userSpaceOnUse" data-v-ec9fe08c><stop stop-color="white" data-v-ec9fe08c></stop><stop offset="0.884426" stop-color="white" stop-opacity="0" data-v-ec9fe08c></stop></linearGradient></defs></svg><aside data-v-ec9fe08c><span data-v-ec9fe08c>COMBAT</span><span data-v-ec9fe08c>TIMELINE</span></aside>',2),le=se(()=>l("path",{d:"M16.7974 20.3694C15.1176 21.4034 13.1389 22 11.0205 22C4.93406 22 -7.46378e-07 17.0751 -4.80825e-07 11C-2.15273e-07 4.92487 4.93406 -1.44536e-06 11.0205 -1.17931e-06C12.8556 -1.0991e-06 14.586 0.447694 16.1079 1.23963L37.9014 11.0859L37.7156 11.0908L38 11.0872L16.7974 20.3694ZM4.00746 11C4.00746 14.866 7.14732 18 11.0205 18C14.8937 18 18.0336 14.866 18.0336 11C18.0336 7.13401 14.8937 4 11.0205 4C7.14732 4 4.00747 7.13401 4.00746 11Z",fill:"white"},null,-1)),ne=[le],re={id:"settings"},ie=j({__name:"stageProgramme",setup(g){const t=q({list:[],inputRaw:"",style:{}}),S=p(0),f=p(!1),u=p(0);let A=p(!0);const r=p(0);let _,T;const B=k(()=>({transform:`scale(${t.style.scale})`,"--stage-programme-height":t.style.lineHeight})),x=p(!1),w=/^(P\d|階段)/,Z=k(()=>t.list.length*(t.style.lineHeight-1.5)-5),D=k(()=>{const o=d.duration(u.value,"seconds");return d({h:o.hours(),m:o.minutes(),s:o.seconds()}).format("mm:ss")});function R(){H(),addOverlayListener("onInCombatChangedEvent",U),document.addEventListener("onOverlayStateUpdate",o=>A.value=!o.detail.isLocked),startOverlayEvents()}function b(){const o=localStorage.getItem("programmeData"),a=localStorage.getItem("programmeStyle");if(o?t.inputRaw=JSON.parse(o):t.inputRaw=`0 階段 - 1
00:11.4 "深度污濁" class="AoE"
00:21.6 "雙重衝擊" class="TankBurster"
00:34.4 "污水氾濫" class="AoE"
階段 - 2
00:54.4 "吐息飛瀑"
01:10.4 "連貫攻擊" class="Shared"
01:33.8 "深度污濁" class="AoE"
01:42.5 "靈水彈" class="Shared"
01:48.3 "震盪波"
02:10.9 "多重刻印" class="Shared"
02:24.3 "展翅飛瀑"
02:47.0 "溝流充溢" class="AoE"
階段 - 3
03:17.1 "雙重衝擊" class="TankBurster"
03:27.3 "深度污濁" class="AoE"
03:44.1 "污水氾濫" class="AoE"
03:58.7 "震盪波"
階段 - 4
04:11.1 "海怪戰車" class="AoE"
04:37.0 "雙重衝擊" class="TankBurster"
04:46.3 "深度污濁" class="AoE"
04:59.9 "溝流溢出" class="AoE"
05:09.1 "污染洪水" class="AoE"
05:24.5 "污染洪水" class="AoE"
05:37.4 "吐息飛瀑"
階段 - 5
06:00.7 "多重刻印" class="Shared"
06:07.0 "分離"
06:20.9 "展翅飛瀑"
06:38.6 "分離"
06:50.8 "污水噴發"
06:58.2 "污染洪水" class="AoE"
07:05.8 "連貫攻擊" class="Shared"
07:28.3 "雙重衝擊" class="TankBurster"
07:36.5 "深度污濁" class="AoE"
07:54.1 "污水氾濫" class="AoE"
階段 - 6
08:10.7 "溝流溢出" class="AoE"
08:21.2 "連貫攻擊" class="Shared"
08:54.6 "分離"
09:06.9 "污水噴發（狂暴）" class="Enrage"
`,a){const e=JSON.parse(a);e.scale<.5&&(e.scale=1),t.style=Object.assign(t.style,e)}else t.style={scale:1,lineHeight:40,customCSS:`/* 如果設定未生效就加上!important強制最高優先順序 */
header {
  width: 360px !important; /* 寬 */
  height: 100px !important; /* 高 */
  border-radius: 8px !important; /* 圓角 */
 } /* 頭部 */
header > .clock {  margin-left: 9px !important; } /* 頭部左側時鐘svg圖示 */
header > aside { /* 兩行字 */
    font-size: 36px !important; /* 字型尺寸 */
    margin-left: 7px !important; /* 左基準偏移 */
    span{ /* 每行字 */
      height: 32px !important; /* 高度 */
    }
}
header > article {
  right: 7px !important; /* 右基準偏移 */
  bottom: 0px !important; /* 下基準偏移 */
  font-size: 64px !important; /* 字型尺寸 */
  height: 74px !important; /* 高度 */
  width: 111px !important; /* 寬度 */
  text-align: left !important; /* 文字左對齊 */
} /* 頭部右側計時文字 */
#main { /* 主體 */
  width: 360px !important;  /* 寬度 */
}
#main > ul { /* 整個無序列表 */
  li{ } /* 內部list */
 }
#main > ul .stage { /* 主體的階段行正文 */
  font-size:18px !important; 
  background-color: rgba(0,0,0,0) !important;
  } 
#main > ul .normal { /* 主體的非階段行左側正文 */
  font-size:22px  !important;
  } 
#main > ul .auxiliary { /* 主體的非階段行右側時間 */
  font-size:18px  !important; 
  text-shadow:none !important; /* 不應用class的顏色 */
  color:white !important; /* 不應用class的顏色 */
  } 
#main .position{ } /* 主體的左側箭頭svg圖示 */
#main > span { /* 主體的左側裝飾線段 */
  left:40px !important; /* 左基準偏移 */
  font-size: 20px !important; /* 字型大小/*
  letter-spacing: 12.625px !important; /* 字元間距 */
  }
:root{
  --color-aoe:rgb(112,48,159); /* 聲明aoe顏色變數 */
  --color-tank-burster:rgb(255,75,75); /* 聲明死刑顏色變數 */
  --color-shared:rgb(0,112,192); /* 聲明分攤顏色變數 */
  --color-enrage:crimson; /* 聲明狂暴顏色變數 */
}
.AoE{ /* 對應正文模板字串內的class AoE */
  /* text-shadow: -1px 0 2px var(--color-aoe), 0 1px 2px var(--color-aoe), 1px 0 2px var(--color-aoe), 0 -1px 2px var(--color-aoe); */
}
.TankBurster{ /* 死刑 */
  /* text-shadow: -1px 0 2px var(--color-tank-burster), 0 1px 2px var(--color-tank-burster), 1px 0 2px var(--color-tank-burster), 0 -1px 2px var(--color-tank-burster); */
}
.Shared{ /* 分攤 */
   /* text-shadow: -1px 0 2px var(--color-shared), 0 1px 2px var(--color-shared), 1px 0 2px var(--color-shared), 0 -1px 2px var(--color-shared); */
}
.Enrage{ /* 狂暴 */
  /* color: var(--color-enrage); */
}
`}}R(),b(),G(()=>{var a;let o=[];[...t.inputRaw.matchAll(/^([ \t　]*(?<time>[:：\d.]+) +)?"?(?<action>.+?)"?(?: *class="(?<className>[^"]+)")?$/gm)].forEach(e=>{var L,M;let s=(L=e.groups)==null?void 0:L.time;if(s!=null&&s.includes(":")){let V=0;s!=null&&s.includes(".")&&(V=Number(s.substr(s.lastIndexOf(".")+1)/10),s=s.substring(0,s.lastIndexOf("."))),s=d.duration(s).as("seconds")/60+V}else s=s?Number(s):null;const E=d.duration(s,"seconds"),P=d({h:E.hours(),m:E.minutes(),s:E.seconds()}).format("mm:ss");o.push({text:e.groups.action,timeSeconds:(s==null?void 0:s.toFixed(1))??null,timeFormat:P,className:((M=e==null?void 0:e.groups)==null?void 0:M.className)??""})}),t.list=o,localStorage.setItem("programmeData",JSON.stringify(t.inputRaw)),localStorage.setItem("programmeStyle",JSON.stringify(t.style));{(a=document.querySelector("#styleHTML"))==null||a.remove();const e=document.createElement("style");e.setAttribute("type","text/css"),e.id="styleHTML",e.innerHTML=t.style.customCSS,document.body.append(e)}});function z(o){return w.test(o)?{fontSize:"18px",justifyContent:"center"}:{}}function U(o){!f.value&&o.detail.inACTCombat&&(_=setInterval(()=>{I()},1e3)),f.value&&!o.detail.inACTCombat&&(clearInterval(_),H()),f.value=o.detail.inACTCombat}function F(){H(),T=setInterval(()=>{I()},100)}function H(){clearInterval(T),f.value=!1,u.value=0,r.value=0,S.value=t.style.lineHeight}function I(){var a;u.value++;for(let e=0;e<t.list.length;e++)if(parseInt(((a=t.list[e].timeSeconds)==null?void 0:a.toString())??"-1")===u.value){S.value=t.style.lineHeight*(e+1),(e>1&&w.test(t.list[e-1].text)||r.value+650-t.style.lineHeight*2.5<t.style.lineHeight*(e+1))&&(r.value=o(t.style.lineHeight*(e-2.5)));break}function o(e){const s=document.querySelector("#main>ul").scrollHeight-650+t.style.lineHeight*1.5;return e>=s&&(e=s),e}}function $(){confirm("確定恢復模板字串為預設設定嗎？")&&(localStorage.removeItem("programmeData"),b())}function J(){confirm("確定恢復自定義CSS為預設設定嗎？")&&(localStorage.removeItem("programmeStyle"),b())}return(o,a)=>(h(),v(N,null,[l("div",{id:"warpper",style:m(n(B))},[l("header",null,[oe,l("article",null,C(n(D)),1)]),l("main",{id:"main",style:m({overflowY:n(x)?"auto":"hidden"})},[(h(),v("svg",{xmlns:"http://www.w3.org/2000/svg",width:"35",viewBox:"0 0 38 22",fill:"none",class:"icon position",style:m({top:n(S)-n(r)+"px",opacity:n(u)})},ne,4)),l("ul",{style:m({transform:`translateY(${-n(r)}px)`})},[(h(!0),v(N,null,Y(n(t).list,(e,s)=>(h(),v("li",{key:s,style:m(Object.assign(z(e.text),{height:n(t).style.lineHeight+"px"})),class:X([w.test(e.text)?"stage":"normal",e.className])},[c(C(e.text)+" ",1),i(l("span",{class:"auxiliary"},C(e.timeFormat),513),[[O,e.timeSeconds&&e.timeSeconds>0&&e.timeFormat]])],6))),128))],4),l("span",{style:m({width:n(Z)+"px",top:`${n(t).style.lineHeight+25*1.5-5-n(r)}px`})},C("-".repeat(299)),5)],4)],4),i(l("aside",re,[l("p",null,[l("button",{onClick:a[0]||(a[0]=e=>F())},"10倍速測試")]),l("p",null,[c(" 正文模板 "),l("button",{onClick:a[1]||(a[1]=e=>$())},"恢復預設正文")]),i(l("textarea",{cols:"80",rows:"20","onUpdate:modelValue":a[2]||(a[2]=e=>n(t).inputRaw=e)},null,512),[[y,n(t).inputRaw]]),l("p",null,[c("總縮放"),i(l("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>n(t).style.scale=e),step:"0.1",min:"0.5"},null,512),[[y,n(t).style.scale]])]),l("p",null,[c("每行高"),i(l("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>n(t).style.lineHeight=e),step:"1",min:"20"},null,512),[[y,n(t).style.lineHeight]])]),l("p",null,[c("允許使用者滾動"),i(l("input",{type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=e=>K(x)?x.value=e:null)},null,512),[[Q,n(x)]]),c("（該選項不會儲存）")]),l("p",null,[c(" 自定義CSS "),l("button",{onClick:a[6]||(a[6]=e=>J())},"恢復預設CSS")]),i(l("textarea",{cols:"80",rows:"30","onUpdate:modelValue":a[7]||(a[7]=e=>n(t).style.customCSS=e)},null,512),[[y,n(t).style.customCSS]])],512),[[O,n(A)]])],64))}});const ue=ae(ie,[["__scopeId","data-v-ec9fe08c"]]);export{ue as default};
