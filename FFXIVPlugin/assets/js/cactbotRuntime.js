import{d as F,o as H,s as z,z as G,C as I,a as C,v as s,x as u,F as l,S as q,f as y,H as f,by as K,J as g,K as S,O as Q,P as $,D,Q as W,E,G as X,R as L}from"./index.js";import"./el-input.js";import{a as Y,E as Z}from"./el-select.js";import{U as M}from"./util.js";/* empty css       */import{E as ee}from"./index3.js";import{_ as ae}from"./_plugin-vue_export-helper.js";import"./scroll.js";const te={key:0,style:{color:"white","text-shadow":"1px 1px 2px black"}},ne={style:{"white-space":"nowrap"}},re=F({__name:"cactbotRuntime",setup(oe){const b=(e,a)=>Array(a).fill(e).map((n,h)=>n+ ++h),i={tank:["MT","ST",...b("T",70)],healer:[...b("H",72)],dps:["D1","D2","D3","D4","D5","D6","D7","D8"],unknown:["unknown"]},P=["21","32","37","19","33","24","40","28","34","30","39","22","20","38","23","31","25","27","35","36"],R=[{id:"10000001",name:"虛構戰士",job:21,inParty:!0},{id:"10000002",name:"虛構騎士",job:19,inParty:!0},{id:"10000003",name:"虛構占星",job:33,inParty:!0},{id:"10000004",name:"虛構學者",job:28,inParty:!0},{id:"10000005",name:"虛構忍者",job:30,inParty:!0},{id:"10000006",name:"虛構武士",job:34,inParty:!0},{id:"10000007",name:"虛構黑魔",job:25,inParty:!0},{id:"10000008",name:"虛構舞者",job:38,inParty:!0}],t=H("souma-cactbot-runtime",z({party:[]})),c={tank:0,healer:0,dps:0,unknown:1};function B(){c.tank=t.value.party.reduce((e,a)=>o(a.job)==="tank"?e+1:e,0),c.healer=t.value.party.reduce((e,a)=>o(a.job)==="healer"?e+1:e,0),c.dps=t.value.party.reduce((e,a)=>o(a.job)==="dps"?e+1:e,0)}const d=location.href.includes("localhost");d&&_({party:R});function o(e){return[1,3,19,21,32,37].includes(e)?"tank":[6,24,28,33,40].includes(e)?"healer":[2,4,5,7,20,22,23,25,26,27,29,30,31,34,35,36,38,39].includes(e)?"dps":"unknown"}function _(e){d&&e.party.length===0||(t.value.party=e.party.map(a=>({...a,rp:""})).sort((a,n)=>P.indexOf(a.job.toString())-P.indexOf(n.job.toString())),t.value.party.forEach(a=>a.rp=k(a.job)),B(),p())}function N(e){const a=t.value.party.find(n=>n.rp===t.value.party[e].rp&&n.id!==t.value.party[e].id);a&&(a.rp=k(a.job)),p()}function k(e){return i[o(e)].find(a=>!t.value.party.find(n=>n.rp===a))??"unknown"}function p(){const e=[...i.tank,...i.healer,...i.dps];t.value.party.sort((a,n)=>e.indexOf(a.rp)-e.indexOf(n.rp)),callOverlayHandler({call:"broadcast",source:"soumaRuntimeJS",msg:{party:t.value.party}})}function j(e){d||(w.value=e.charName)}function O(e){if(e.source==="soumaUserJS")switch(e.msg.text){case"updateNewPartyRP Success":ee("通訊成功");break;case"requestData":p();break}}G(()=>{p(),addOverlayListener("PartyChanged",_),addOverlayListener("ChangePrimaryPlayer",j),addOverlayListener("BroadcastMessage",O),startOverlayEvents()}),I(()=>{removeOverlayListener("PartyChanged",_),removeOverlayListener("ChangePrimaryPlayer",j),removeOverlayListener("BroadcastMessage",O)});const v=C(!1),w=C(d?"虛構占星":"");function V(){v.value=!0}function T(){v.value=!1}return(e,a)=>{const n=Y,h=Z,U=Q,A=$;return s(),u(g,null,[l(t).party.length===0?(s(),u("span",te,"等待小隊...")):q("",!0),y(A,{onMouseenter:V,onMouseleave:T},{default:f(()=>[y(U,null,{default:f(()=>[y(K,{name:"animate__animated animate__bounce","enter-active-class":"animate__fadeInLeft","leave-active-class":"animate__fadeOutLeft"},{default:f(()=>[(s(!0),u(g,null,S(l(t).party,(r,J)=>D((s(),u("div",{key:r.id,flex:"~ nowrap"},[y(h,{modelValue:r.rp,"onUpdate:modelValue":m=>r.rp=m,size:"small","m-0":"","p-0":"",onChange:m=>N(J),teleported:!1},{default:f(()=>[(s(!0),u(g,null,S(i[o(r.job)],(m,x)=>D((s(),W(n,{key:x,value:m,"fit-input-width":!0},null,8,["value"])),[[E,x<c[o(r.job)]]])),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),X("span",ne,L(l(M).nameToFullName(l(M).jobEnumToJob(r.job)).simple2)+" "+L(r.name),1)])),[[E,l(v)||r.name===l(w)]])),128))]),_:1})]),_:1})]),_:1})],64)}}});const ye=ae(re,[["__scopeId","data-v-4ea8df28"]]);export{ye as default};
