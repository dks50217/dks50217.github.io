import{u as P,p as Z,_ as q}from"./timeline2.js";import{d as H,s as J,a as S,o as K,c as I,ar as T,v as c,x as r,D as R,E as Q,F as o,J as U,K as W,S as _,f as X,R as k,at as Y,au as e2,G as t2}from"./index.js";import{_ as n2}from"./_plugin-vue_export-helper.js";import"./util.js";import"./xivapi.js";const i2=y=>(Y("data-v-04b73e2d"),y=y(),e2(),y),o2={id:"wrapper"},a2=i2(()=>t2("path",{d:"M943.321212 577.163636c12.412121 18.618182 31.030303 31.030303 55.854546 37.236364 6.206061 0 12.412121 6.206061 12.412121 6.206061 6.206061 6.206061 18.618182 18.618182 18.618182 31.030303v24.824242c-6.206061 24.824242-12.412121 43.442424-24.824243 62.060606l-6.20606 12.412121c-6.206061 12.412121-12.412121 18.618182-24.824243 24.824243-6.206061 6.206061-18.618182 6.206061-24.824242 6.20606-6.206061 0-12.412121 0-18.618182-6.20606-18.618182-6.206061-37.236364-6.206061-55.854546-6.206061h6.206061-12.412121c-18.618182 0-31.030303 6.206061-43.442424 12.412121 0 0-12.412121 6.206061-24.824243 18.618182-12.412121 12.412121-24.824242 37.236364-24.824242 62.060606 0 18.618182 0 37.236364 12.412121 62.060606 6.206061 12.412121 6.206061 31.030303-6.206061 43.442425-12.412121 12.412121-24.824242 18.618182-37.236363 24.824242-6.206061 6.206061-37.236364 18.618182-68.266667 24.824242 37.236364-6.206061 12.412121 0-12.412121 0h-6.206061c-6.206061 0-12.412121 0-18.618182-6.20606-6.206061-6.206061-12.412121-12.412121-12.412121-24.824243v6.206061c-12.412121-31.030303-31.030303-55.854545-55.854545-68.266667 0-6.206061-24.824242-12.412121-49.648485-12.412121s-49.648485 6.206061-68.266667 24.824243c-24.824242 18.618182-43.442424 43.442424-49.648485 74.472727 0-6.206061-6.206061 0-12.412121 0 0 0-12.412121 6.206061-18.618182 6.20606-12.412121 0-18.618182 0-37.236363-6.20606-12.412121-6.206061-24.824242-6.206061-37.236364-12.412121l-37.236364-18.618182c-12.412121-6.206061-18.618182-12.412121-24.824242-24.824243-6.206061-6.206061-6.206061-12.412121-6.206061-18.618181 0-6.206061 0-18.618182 6.206061-31.030304 6.206061-6.206061 12.412121-24.824242 12.412121-49.648484s-12.412121-43.442424-31.030303-62.060606c-12.412121-12.412121-24.824242-18.618182-43.442424-24.824243h-24.824242-6.206061c-12.412121 0-31.030303 6.206061-49.648485 6.206061h-12.412121c-6.206061 0-12.412121 0-18.618182-6.206061-6.206061 0-12.412121-12.412121-24.824242-18.618182-18.618182-31.030303-31.030303-68.266667-37.236364-105.50303v-6.206061c0-18.618182 12.412121-24.824242 24.824242-31.030303 24.824242-6.206061 43.442424-24.824242 62.060606-43.442424 18.618182-6.206061 24.824242-31.030303 24.824243-55.854545s-6.206061-49.648485-24.824243-68.266667C62.060606 415.806061 31.030303 397.187879 0 390.981818c18.618182 6.206061 12.412121 0 12.412121-6.20606-6.206061-6.206061-6.206061-18.618182-6.20606-24.824243 0-6.206061 0-18.618182 6.20606-31.030303 6.206061-24.824242 18.618182-49.648485 31.030303-68.266667-12.412121 24.824242-6.206061 12.412121 0 6.206061 0-12.412121 6.206061-18.618182 12.412121-24.824242 6.206061 0 6.206061-6.206061 12.412122-6.206061s12.412121 0 18.618181 6.206061c24.824242 6.206061 49.648485 12.412121 74.472728 6.20606 24.824242 0 43.442424-12.412121 62.060606-31.030303 12.412121-12.412121 18.618182-24.824242 18.618182-43.442424 6.206061 0 6.206061-12.412121 6.20606-24.824242v-18.618182-18.618182c0-18.618182-6.206061-43.442424-12.412121-62.060606 6.206061 31.030303 0 18.618182 0 6.20606v0c12.412121-6.206061 18.618182-12.412121 31.030303-18.618181l37.236364-18.618182c12.412121-6.206061 24.824242-6.206061 37.236363-12.412121 12.412121-6.206061 24.824242-6.206061 31.030303-6.206061 12.412121 0 18.618182 0 24.824243 12.412121 6.206061 6.206061 12.412121 18.618182 12.412121 31.030303 6.206061 12.412121 18.618182 24.824242 37.236364 43.442424s37.236364 24.824242 62.060606 24.824243 49.648485-6.206061 68.266666-18.618182c24.824242-24.824242 37.236364-43.442424 43.442425-68.266667 0-6.206061 6.206061-12.412121 12.412121-18.618181 6.206061 0 12.412121-6.206061 18.618182-6.206061 12.412121 0 18.618182 0 31.030303 6.206061 12.412121 0 24.824242 6.206061 37.236363 12.412121 12.412121 6.206061 24.824242 12.412121 31.030303 18.618182 12.412121 6.206061 18.618182 18.618182 24.824243 24.824242 0 6.206061 6.206061 6.206061 6.20606 12.412121v6.206061c0 6.206061-6.206061 18.618182-6.20606 24.824242 0 6.206061-6.206061 24.824242-6.206061 37.236364v18.618182c6.206061 24.824242 12.412121 43.442424 31.030303 62.060606 18.618182 18.618182 37.236364 24.824242 62.060606 31.030303 24.824242 0 49.648485 0 68.266667-12.412121 6.206061 0 12.412121-6.206061 18.618182-6.206061h6.20606c6.206061 0 18.618182 6.206061 24.824243 12.412121 12.412121 12.412121 18.618182 24.824242 31.030303 43.442424 6.206061 18.618182 12.412121 43.442424 18.618182 62.060607 0 12.412121 0 24.824242-6.206061 31.030303-6.206061 6.206061-12.412121 12.412121-24.824242 18.618181-24.824242 6.206061-49.648485 31.030303-62.060606 55.854546-6.206061 6.206061-12.412121 24.824242-12.412122 49.648485-6.206061 24.824242 0 49.648485 18.618182 68.266666zM682.666667 341.333333c-43.442424-43.442424-105.50303-68.266667-167.563637-68.266666-31.030303 0-62.060606 6.206061-93.090909 18.618181-43.442424 18.618182-80.678788 49.648485-105.50303 86.884849-6.206061-6.206061-24.824242 37.236364-37.236364 80.678788 0-18.618182-6.206061 12.412121-6.20606 49.648485 0 31.030303 6.206061 62.060606 18.618181 93.090909 12.412121 31.030303 31.030303 55.854545 49.648485 74.472727 18.618182 24.824242 49.648485 37.236364 74.472728 49.648485 31.030303 12.412121 62.060606 18.618182 93.090909 18.618182s62.060606-6.206061 93.090909-18.618182c43.442424-18.618182 80.678788-49.648485 105.50303-86.884849-6.206061 12.412121 12.412121-12.412121 24.824243-43.442424 12.412121-31.030303 18.618182-62.060606 18.618181-93.090909s-6.206061-62.060606-18.618181-93.090909C713.69697 372.363636 682.666667 335.127273 645.430303 310.30303l37.236364 31.030303z","p-id":"2216"},null,-1)),l2=[a2],s2={key:0,class:"optionalTimelines"},c2=["onClick"],r2={key:4},u2=H({__name:"timeline",setup(y){const n=P(),a=J({loadedTimeline:[],optionalTimeline:[]}),v=S(0),l=S(0-n.configValues.preBattle),w=S(0);let m=!1;const s=K("timeline-condition",{zoneId:"0",job:"NONE"}),C=S(window.location.href.match(/localhost/)),L=I(()=>a.loadedTimeline.filter(e=>e.sync)),x=I(()=>a.loadedTimeline.filter(e=>e.tts));V();function V(){addOverlayListener("onLogEvent",A),addOverlayListener("onPlayerChangedEvent",M),addOverlayListener("ChangeZone",O),addOverlayListener("BroadcastMessage",z),addOverlayListener("onInCombatChangedEvent",F),startOverlayEvents(),n.loadTimelineSettings(),T.isVisible()||T.fire({text:`${n.allTimelines.length}條時間軸已就緒`,showConfirmButton:!1,timer:1500,backdrop:!1}),g(s.value)}function $(){const e=window.open("/ff14-overlay-vue/#/timelineSettings?timestamp="+new Date().getTime(),"_blank","width=1200,height=800"),t=setInterval(function(){e!=null&&e.closed&&(clearInterval(t),n.loadTimelineSettings(),g(s.value))},500)}function g(e){p(),a.loadedTimeline.length=0,a.optionalTimeline.length=0;let t=n.getTimeline(e);t.length===1?B(t[0]):t.length>1&&(a.optionalTimeline=t)}function j(e){B(e)}async function B(e,t=!0){t&&p(),m=!1,e&&(e!=null&&e.timeline)&&(a.loadedTimeline=await Z(e.timeline),a.loadedTimeline.sort((u,i)=>u.time-i.time),T.fire({position:"top-end",icon:"success",text:`載入了${e.name}~`,showConfirmButton:!1,timer:1e3,backdrop:!1})),setTimeout(()=>m=!0,500)}function p(){v.value=0,l.value=0-n.configValues.preBattle,w.value=0,a.loadedTimeline.map(e=>e.alertAlready=!1)}function h(e,t=!0){t&&(m=!1,setTimeout(()=>m=!0,500)),l.value=0,w.value=0,v.value=new Date().getTime()+e*1e3,x.value.map(u=>u.alertAlready=!1),D()}function D(){if(v.value===0)return;l.value=(new Date().getTime()-v.value+w.value)/1e3;const e=x.value.find(t=>!t.alertAlready&&t.time-n.configValues.ttsAdvance<=l.value);e&&(e.alertAlready=!0,N(e.tts)),requestAnimationFrame(D)}function A(e){var t,u;for(const i of e.detail.logs){let b=i.match(/^.{14} \w+ 00:(?:00b9|0[12]39)::?(?:距離戰鬥開始還有|Battle commencing in |戦闘開始まで)(?<cd>\d+)[^（(]+[（(]/i);if(b)h(parseInt(b.groups.cd));else if(/^.{14} Director 21:.{8}:4000000F/.test(i)||/^.{14} ChatLog 00:0038::end$/.test(i))p();else if(/^.{14} ChatLog 00:0038::/.test(i)){const f=(u=(t=i.match(/^.{14} ChatLog 00:0038::(?<name>.+)$/))==null?void 0:t.groups)==null?void 0:u.name;if(f){const d=n.getTimeline(s.value).find(G=>G.name===f);d&&B(d,!1)}}else{const f=L.value.find(d=>d.sync.test(i)&&l.value>=d.time-d.windowBefore&&l.value<=d.time+Number(d.windowAfter));f&&E(f.jump||f.time)}}}function E(e){m=!1,v.value===0&&h(0,!1),w.value+=(e-l.value)*1e3,setTimeout(()=>m=!0,500)}function M(e){e.detail.job!==s.value.job?(s.value.job=e.detail.job,g(s.value)):s.value.job=e.detail.job}function O(e){s.value.zoneId=String(e.zoneID),g(s.value)}function N(e){e&&m&&callOverlayHandler({call:"cactbotSay",text:e})}function z(e){e.source==="soumuaTimelineSetting"&&e.msg.store&&T.fire({text:`接受到${e.msg.store.allTimelines.length}個時間軸`,showDenyButton:!0,denyButtonText:"覆蓋",showConfirmButton:!0,confirmButtonText:"追加",showCancelButton:!0,cancelButtonText:"放棄",backdrop:!1}).then(t=>{(t.isConfirmed||t.isDenied)&&(t.isDenied&&(n.allTimelines.length=0),n.allTimelines=e.msg.store.allTimelines,n.configValues=e.msg.store.configValues,n.showStyle=e.msg.store.showStyle,n.saveTimelineSettings(),T.fire("接受成功"),g(s.value))})}function F(e){e.detail.inGameCombat&&e.detail.inACTCombat?h(0):!e.detail.inGameCombat&&!e.detail.inACTCombat&&p()}return(e,t)=>{const u=q;return c(),r("div",o2,[R((c(),r("svg",{onClick:t[0]||(t[0]=i=>$()),t:"1652767124032",class:"icon",viewBox:"0 0 1030 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2215",width:"16",height:"16"},l2,512)),[[Q,o(v)===0]]),o(a).optionalTimeline.length&&o(l)<=-o(n).configValues.preBattle?(c(),r("ul",s2,[(c(!0),r(U,null,W(o(a).optionalTimeline,(i,b)=>(c(),r("li",{key:b,onClick:f=>j(i)},k(i.condition.job)+" - "+k(i.name),9,c2))),128))])):_("",!0),X(u,{config:o(n).configValues,lines:o(a).loadedTimeline,runtime:o(l),"show-style":o(n).showStyle},null,8,["config","lines","runtime","show-style"]),o(C)?(c(),r("button",{key:1,onClick:t[1]||(t[1]=i=>h(30))},"開始從-30")):_("",!0),o(C)?(c(),r("button",{key:2,onClick:t[2]||(t[2]=i=>h(0))},"開始從0")):_("",!0),o(C)?(c(),r("button",{key:3,onClick:t[3]||(t[3]=i=>p())},"團滅")):_("",!0),o(C)?(c(),r("span",r2,k(o(l)),1)):_("",!0)])}}});const p2=n2(u2,[["__scopeId","data-v-04b73e2d"]]);export{p2 as default};
