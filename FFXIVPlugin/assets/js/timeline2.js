import{d as B,v as h,x as g,J as E,K as v,T as N,S as L,D as F,E as D,Z as O,G as u,R as $,q as M,ar as _}from"./index.js";import{_ as x}from"./_plugin-vue_export-helper.js";import{U as r}from"./util.js";import{g as H,a as k}from"./xivapi.js";const C=["innerHTML"],V={style:{padding:"0px 1px"}},P=B({__name:"timelineShow",props:{config:null,lines:null,runtime:null,showStyle:null},setup(e){const t=e;return(i,a)=>e.lines.length?(h(),g("ul",{key:0,class:"loadedTimelines",style:N(e.showStyle)},[(h(!0),g(E,null,v(t.lines,(n,o)=>F((h(),g("li",{key:o,class:O({upcoming:n.time-e.runtime<=e.config.discoloration,fade:n.time-e.runtime<=0-e.config.hold,passed:n.time-e.runtime<=0})},[u("aside",{style:N({right:Math.max((n.time-e.runtime)/e.config.displayDuration,0)*100+"%"})},null,4),u("section",null,[u("span",{innerHTML:n.actionHTML},null,8,C),u("span",V,$((n.time-e.runtime).toFixed(1)),1)])],2)),[[D,n.show&&n.time-e.runtime>0-e.config.hold-e.showStyle["--tras-duration"]&&n.time-e.runtime<=e.config.displayDuration]])),128))],4)):L("",!0)}});const te=x(P,[["__scopeId","data-v-f29cd7ae"]]);var l=(e=>(e.顯示範圍="displayDuration",e.變色時間="discoloration",e.零后持續="hold",e.戰前準備="preBattle",e.TTS提前量="ttsAdvance",e))(l||{});class R{constructor(t,i,a,n){r.iconToJobEnum(i.job)&&(i.job=r.jobEnumToJob(r.iconToJobEnum(i.job))),this.name=t,this.condition=i,this.timeline=a,this.codeFight=n,this.create=new Date().toLocaleString()}}const U={[l.顯示範圍]:"顯示範圍（秒）",[l.變色時間]:"提前變色（秒）",[l.零后持續]:"後續保持（秒）",[l.戰前準備]:"倒計時量（秒）",[l.TTS提前量]:"TTS預備（秒）"},q={[l.顯示範圍]:120,[l.變色時間]:2.75,[l.零后持續]:.5,[l.戰前準備]:30,[l.TTS提前量]:1},G={"--timeline-width":"時間軸寬度","--font-size":"字型大小","--normal-scale":"等待縮放","--up-coming-scale":"來臨縮放","--opacity":"等待不透明度","--tras-duration":"動畫時間"};let K={"--timeline-width":180,"--font-size":18,"--opacity":.33,"--normal-scale":.5,"--up-coming-scale":1,"--tras-duration":1};const ne=M("timeline",{state:()=>({allTimelines:[],configValues:q,configTranslate:U,settings:{api:""},filters:{},showStyle:K,showStyleTranslate:G}),getters:{},actions:{newTimeline(e="Demo",t={zoneId:"0",job:"NONE"},i=`# 註釋的內容不會被解析
# "<技能名>"會被解析為圖片 緊接著一個波浪線可快捷重複技能名
-20 "<中間學派>~刷盾"
0 "戰鬥開始" tts "衝呀"
# 當sync在window的範圍內被滿足時將進行時間同步
30 "一運" sync / 14:4.{7}:[^:]*:AAAA:/ window 2.5,2.5
# 當存在jump時會進跳轉至jump時間
50 "變異化型:蛇" sync / 14:4.{7}:[^:]*:BBBB:/ window 2.5,2.5 jump 1000
50 "變異化型:獸" sync / 14:4.{7}:[^:]*:CCCC:/ window 2.5,2.5 jump 2000
1000 "蛇軸"
2000 "獸軸"
`,a="使用者建立"){return this.allTimelines.push(new R(e,t,i,a)),this.sortTimelines(),_.fire({position:"center",icon:"success",title:`「${e}」已建立`,showConfirmButton:!1,timer:1e3}),this.allTimelines.findIndex(o=>o.timeline===i&&o.name===e&&JSON.stringify(o.condition)===JSON.stringify(t)&&o.codeFight===a)},getTimeline(e){return this.allTimelines.filter(t=>(t.condition.zoneId==="0"||t.condition.zoneId===e.zoneId)&&(t.condition.job==="NONE"||t.condition.job===e.job))},saveTimelineSettings(){localStorage.setItem("timelines",JSON.stringify({allTimelines:this.allTimelines,configValues:this.configValues,settings:this.settings,showStyle:this.showStyle,filters:this.filters}))},loadTimelineSettings(){const e=localStorage.getItem("timelines");e&&(Object.assign(this,JSON.parse(e)),this.allTimelines.forEach(t=>{t.condition.jobList&&(t.condition.job=t.condition.jobList[0]??"NONE",delete t.condition.jobList)}),this.sortTimelines()),this.allTimelines.forEach(t=>{r.iconToJobEnum(t.condition.job)&&(t.condition.job=r.jobEnumToJob(r.iconToJobEnum(t.condition.job)))})},sortTimelines(){this.allTimelines.sort((e,t)=>Number(e.condition.zoneId)===Number(t.condition.zoneId)?r.jobToJobEnum(e.condition.job)-r.jobToJobEnum(t.condition.job):Number(e.condition.zoneId)-Number(t.condition.zoneId))}}});function Z(e){var i;const t=e.match(/^(?<negative>-)?(?<mm>[^:：]+):(?<ss>[^:：]+)$/);return t?parseFloat(t.groups.mm)*60+parseFloat(t.groups.ss)*((i=t.groups)!=null&&i.negative?-1:1):parseFloat(e)}function A(e){return e.matchAll(/\<(?<name>[^\<\>]*?)!??\>(?<repeat>~)?/g)}async function Q(e){var i,a;e=e.replaceAll(/^["']|["']$/g,"");const t=A(e);if(!t)return Promise.resolve(e);for(const n of t)if((i=n.groups)!=null&&i.name){let o;try{o=await H(await k(n.groups.name).then(c=>(c==null?void 0:c.Icon)??""))}catch{}e=e.replace(n[0],`${o?`<div class="skill_icon"><img src='${o}' loading="lazy"/></div>`:""}${(a=n.groups)!=null&&a.repeat?n.groups.name:""}`)}return Promise.resolve(e)}async function ie(e){var a,n,o,c,f,p,w,T,y;const t=[],i=[...e.matchAll(/^(?<time>[-:：\d.]+)\s+(?<action>(--|["'])[^"'\n]+?\3).*$/gm)];for(let m=0;m<i.length;m++){const s=i[m],S=(a=s[0].match(new RegExp("(?<=jump ?)[-:：\\d.]+")))==null?void 0:a[0],d=(n=s[0].match(new RegExp("(?<=sync ?\\/).+(?=\\/)")))==null?void 0:n[0],b=(o=s[0].match(new RegExp("(?<=window ?)[-:：\\d.]+")))==null?void 0:o[0],j=(c=s[0].match(new RegExp("(?<=window ?[-:：\\d.]+,)[-:：\\d.]+")))==null?void 0:c[0],I=(p=(f=s[0].match(/ tts ?["'](?<tts>[^"']+)["']/))==null?void 0:f.groups)==null?void 0:p.tts,z=/ tts(?: |$)/.test(s[0])?(y=(T=(w=Array.from(A(s.groups.action)))==null?void 0:w[0])==null?void 0:T.groups)==null?void 0:y.name:void 0,J=await Q(s.groups.action);t.push({time:Z(s.groups.time),actionHTML:s.groups.action?J:"",alertAlready:!1,sync:d?new RegExp(d):void 0,show:!d,windowBefore:parseFloat(b||j||"2.5"),windowAfter:parseFloat(j||b||"2.5"),jump:S?parseFloat(S):void 0,tts:I||z})}return t.sort((m,s)=>m.time-s.time),t}export{te as _,ie as p,ne as u};
